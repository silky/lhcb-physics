// $Id: Simulation.opts,v 1.50 2004-03-23 17:45:02 gcorti Exp $ 

////////////////////////////////////////////////////////////////////
// configuration of services

ApplicationMgr.DLLs  += { "SimSvc" };

#include "$STDOPTS/DetDesc.opts"
DetectorDataSvc.DetDbLocation = "$XMLDDDBROOT/DDDB/lhcb.xml";

// declare external services needed MAGNETIC FIELD 
ApplicationMgr.ExtSvc +=  { "MagneticFieldSvc"  };  
MagneticFieldSvc.FieldMapFile = "$FIELDMAP";

///////////////////////////////////////////////////////////////////


ApplicationMgr.DLLs += 
{ "GiGa"         , 
  "GiGaCnv"      , 
  "GaussTracker" ,
  "GaussRICH"    ,
  "GaussCalo"    ,
  "GaussPhysics" ,   
  "Magnet"       ,
  "CaloEvent"    ,  
  "CaloDetXmlCnv"} ;

ApplicationMgr.ExtSvc += 
{ "GiGa" , 
  "GiGaKine" ,          
  "GiGaGeo"  ,   
  "GiGaHits" } ;

EventPersistencySvc.CnvServices += 
{ "GiGaKine" ,  
  "GiGaHits" } ;

Simulation.Members += 
{ "GiGaDataStoreAlgorithm/GiGaStore" ,   // data store configuration
  "GiGaInputStream/Geo"              ,   // load the geometry 
  "GiGaInputStream/Kine"                 // load the kinematics 
//, "GiGaFlushAlgorithm/GiGaFlush"         // flush the event 
//, "PrintEventAlg"                        // get MCParticles/MCVertices
, "GiGaGetHitsAlg/GetHits"               // get MCHits
};

// configuration of GiGa Data Store 
GiGaStore.ConversionServices   = 
{ "GiGaKine" , 
  "GiGaHits" };

// configuration of kinematics event "Kine" data stream 
Kine.ConversionSvcName         = "GiGaKine" ; 
Kine.DataProviderSvcName       = "EventDataSvc"   ; 
Kine.StreamItems              += 
{  "/Event/Gen/HepMCEvents" };

// configuration of geometry "Geo" data stream
Geo.ExecuteOnce          = true ;   
Geo.ConversionSvcName    = "GiGaGeo"  ; 
Geo.DataProviderSvcName  = "DetectorDataSvc" ; 

Geo.StreamItems         += {"/dd/Structure/LHCb/Pipe"}; 
Geo.StreamItems         += {"/dd/Structure/LHCb/Magnet"}; 
Geo.StreamItems         += {"/dd/Structure/LHCb/Velo"}; 
Geo.StreamItems         += {"/dd/Structure/LHCb/Velo2Rich1"};
Geo.StreamItems         += {"/dd/Structure/LHCb/Rich1"}; 
Geo.StreamItems         += {"/dd/Geometry/Rich1/Rich1Surfaces"};
Geo.StreamItems         += {"/dd/Geometry/Rich1/RichHPDSurfaces"};
Geo.StreamItems         += {"/dd/Structure/LHCb/OT"}; 
Geo.StreamItems         += {"/dd/Structure/LHCb/IT"};
Geo.StreamItems         += {"/dd/Structure/LHCb/Rich2"}; 
Geo.StreamItems         += {"/dd/Geometry/Rich2/Rich2Surfaces"};
Geo.StreamItems         += {"/dd/Structure/LHCb/Spd"};  
Geo.StreamItems         += {"/dd/Structure/LHCb/Converter"};
Geo.StreamItems         += {"/dd/Structure/LHCb/Prs"};
Geo.StreamItems         += {"/dd/Structure/LHCb/Ecal"};
Geo.StreamItems         += {"/dd/Structure/LHCb/Hcal"};
Geo.StreamItems         += {"/dd/Structure/LHCb/Muon"};

// physics list  and the production cuts  
GiGa.PhysicsList              = "GiGaPhysListModular/ModularPL";
GiGa.ModularPL.CutForElectron = 10000.0 * m;
GiGa.ModularPL.CutForPositron = 5.0 * mm; 
GiGa.ModularPL.CutForGamma    = 10.0 * mm;
//GiGa.ModularPL.DumpCutsTable = true;

GiGa.ModularPL.PhysicsConstructors += 
  { "GiGaExtPhysics<GeneralPhysics>/GeneralPhysics" } ;
GiGa.ModularPL.PhysicsConstructors += 
  { "GiGaExtPhysics<EMPhysics>/EMPhysics"           } ;
GiGa.ModularPL.PhysicsConstructors += 
  { "GiGaExtPhysics<MuonPhysics>/MuonPhysics"       } ;
GiGa.ModularPL.PhysicsConstructors += 
  { "GiGaExtPhysics<HadronPhysicsLHEP>/LHEPPhysics" } ;
GiGa.ModularPL.PhysicsConstructors += 
  { "GiGaExtPhysics<IonPhysics>/IonPhysics"         } ;
GiGa.ModularPL.PhysicsConstructors += 
  { "GiGaPhysConstructorOp"                         } ;
GiGa.ModularPL.PhysicsConstructors += 
  { "GiGaPhysConstructorHpd"                        } ;


// mandatory run action  
GiGa.RunAction                 =   "GiGaRunActionSequence/RunSeq"      ;
GiGa.RunSeq.Members           += { "TrCutsRunAction/TrCuts"};
GiGa.RunSeq.Members           += { "GiGaRunActionCommand/RunCommand" } ;
GiGa.RunSeq.RunCommand.BeginOfRunCommands     = 
{ "/tracking/verbose 0",
  "/tracking/storeTrajectory  0"} ;

// mandatory event action  
GiGa.EventAction           =   "GiGaEventActionSequence/EventSeq"      ;

// mandatory tracking action (1/2)
GiGa.TrackingAction         =   "GiGaTrackActionSequence/TrackSeq"    ;
GiGa.TrackSeq.Members      += { "GaussTrackActionStart/TrackStart" }; 

// tracking actions to be applied in the whole experimental setup
//   primary particles and predefined (forced) decays
GiGa.TrackSeq.Members      += { "GaussTrackActionGeneral/TrackLHCbGen" }; 
// keep default StoreAll(false), Primaries(true), StorePreDecays(true)
// GiGa.TrackSeq.TrackLHCbGen.StoreAll       = false ; // def
// GiGa.TrackSeq.TrackLHCbGen.Primaries      = true  ;
// GiGa.TrackSeq.TrackLHCbGen.StorePreDecays = true  ;
GiGa.TrackSeq.TrackLHCbGen.StoreDecays    = false ;
//   particle types = muons from/to any process
GiGa.TrackSeq.Members      += { "GaussTrackActionByType/TrackLHCbType" }; 
GiGa.TrackSeq.TrackLHCbType.OwnTypes   = {"mu+" , "mu-" } ;
GiGa.TrackSeq.TrackLHCbType.ChildTypes = {"mu+" , "mu-" } ;
//   

// tracking actions to be applied before the SPD/PrS
//   particles involved in a decay
GiGa.TrackSeq.Members      += { "GaussTrackActionByProcess/TrackProcess" };
GiGa.TrackSeq.TrackProcess.zMax           = 11290 * mm;
GiGa.TrackSeq.TrackProcess.OwnProcesses   = { "G4Decay" };
GiGa.TrackSeq.TrackProcess.ChildProcesses = { "G4Decay" };
//   particles (gamma, e+/-) with E at production > Ethresold
GiGa.TrackSeq.Members      += { "GaussTrackActionByEnergy/TrackEthres" };
GiGa.TrackSeq.TrackEthres.zMax      = 11290 * mm;
GiGa.TrackSeq.TrackEthres.Threshold = 100 * MeV ;

///////////////////////////////////////////////////////////////////////
// all the subdetector specific actions should be added here:

// specific RICH options
#include "$GAUSSRICHROOT/options/Rich.opts"

// specific configuration of calorimeter stuff 
#include "$GAUSSCALOROOT/options/Calo.opts" 

//////////////////////////////////////////////////////////////////////

// mandatory tracking action (2/2)
GiGa.TrackSeq.Members      += { "GaussTrackActionFinal/TrackLast" } ;
GiGa.TrackSeq.TrackLast.StoreMarked   = true;
GiGa.TrackSeq.TrackLast.StoreWithHits = false;

// mandatory stepping action   
GiGa.SteppingAction               =   "GiGaStepActionSequence/StepSeq"  ;
GiGa.StepSeq.Members             += { "GaussStepAction/GaussStep" } ;

// "Global Field Manager" 
GiGaGeo.FieldManager           = "GiGaFieldMgr/FieldMgr";
GiGaGeo.FieldMgr.Stepper       = "ClassicalRK4"; 
GiGaGeo.FieldMgr.Global        = true;
GiGaGeo.FieldMgr.MagneticField = "GiGaMagFieldGlobal/LHCbField";
GiGaGeo.LHCbField.MagneticFieldService = "MagneticFieldSvc";

// setting simulation attributes
GiGa.GiGaMgr.RunTools += { "GiGaSetSimAttributes" };

// sensdet paths (to be moved away at some stage...)
GiGaGeo.ITSDet.DetectorPath    = "/Tracker/IT";
GiGaGeo.VeloSDet.DetectorPath  = "/Velo";
GiGaGeo.OTSDet.DetectorPath    = "/Tracker/OT";


