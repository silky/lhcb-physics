///////////////////////////////////////////////////////////////////////////////
///   Job options for Brunel for data produced with Boole v11r0 or greater  ///
///   geometry lhcb-200601 (DC06), with ETC as input                        ///
///////////////////////////////////////////////////////////////////////////////
#pragma print off
#include "$BRUNELOPTS/DstContent.opts"       // Define DST content
#include "$BRUNELOPTS/Brunel.opts"           // Set up the processing sequences
#include "$BRUNELOPTS/BrunelMC.opts"         // Comment for real data
//#include "$BRUNELOPTS/ExpertCheck.opts"    // Uncomment for expert check histos
ApplicationMgr.OutStream += { "DstWriter" }; // Comment to switch off DST output

// Allow two input files open at the same time (.etc, and .digi)
PoolDbCacheSvc.AgeLimit = 1; // set to 2 if ExpertCheck enabled

//---------------------------------------------------------------------------
// Remove knowledge of /Rec to avoid opening file from which ETC was created
//---------------------------------------------------------------------------
InitEtcSeq.Members = { "EventNodeKiller" };
EventNodeKiller.Nodes = { "Rec" };

//---------------------------------------------------------------------------
// Add selection results to DST
//---------------------------------------------------------------------------
ApplicationMgr.ExtSvc += {"TagCollectionSvc/EvtTupleSvc"};
InitBrunelSeq.Members += { "ReadStripETC/TagReader" };
TagReader.CollectionName = "TagCreator" ;

//---------------------------------------------------------------------------
// Set up DC06 geometry, conditions, magnetic field
//---------------------------------------------------------------------------
#pragma print on
#include "$STDOPTS/DC06Conditions.opts"

//---------------------------------------------------------------------------
// Write an ETC for the selected DST - must be done AFTER writing the DST
//---------------------------------------------------------------------------
ApplicationMgr.OutStream += { "GaudiSequencer/SeqTagWriter"};
SeqTagWriter.Members += { "CopyStripETC/TagCreator", 
                          "EvtCollectionStream/TagWriter" } ;
TagCreator.InputCollectionName = "TagCreator" ;
TagCreator.EvtColsProduce = true;   // switch it on
TagCreator.HistoProduce   = false;  // no histos
TagCreator.EvtColLUN      = "EVTTAGS2";
TagCreator.OutputCollectionName = "EVTTAGS2/TagCreator/Strip" ;

TagWriter.ItemList = { "/NTUPLES/EVTTAGS2/TagCreator/1" };
TagWriter.EvtDataSvc = "EvtTupleSvc";

//---------------------------------------------------------------------------
// Add here any job specific options, to over-ride previously defined options
//---------------------------------------------------------------------------

//---------------------------------------------------------------------------
// Number of events to process, optionally skipping some events
//---------------------------------------------------------------------------
ApplicationMgr.EvtMax = -1;
//EventSelector.FirstEvent = 7;  // To skip some events
 
//---------------------------------------------------------------------------
// Histogram output
//---------------------------------------------------------------------------
HistogramPersistencySvc.OutputFile = "0601-11144100-evt.root";  // Monitoring histos

//---------------------------------------------------------------------------
// POOL file catalogs. First one is read-write, others are read only
//---------------------------------------------------------------------------
PoolDbCacheSvc.Catalog = {
  "xmlcatalog_file:$BRUNELROOT/job/NewCatalog.xml"
 ,"xmlcatalog_file:$BRUNELROOT/job/etc_9075_3_catalog.xml" // corresponds to ETC
};

//---------------------------------------------------------------------------
// Event input
//---------------------------------------------------------------------------
EventSelector.Input = {
  "COLLECTION='TagCreator/1' DATAFILE='PFN:rfio:/castor/cern.ch/user/c/cattanem/Brunel/v30r10/ETC_00009075_00000003.root'  TYP='POOL_ROOTTREE' SEL='(GlobalOr>=1)'"
};  // Generated by Joel from DC06 rDSTs

//---------------------------------------------------------------------------
// Event output
//---------------------------------------------------------------------------
DstWriter.Output = "DATAFILE='PFN:0601-11144100-evt.dst' TYP='POOL_ROOTTREE' OPT='REC'";

//---------------------------------------------------------------------------
// Event Tag Collection output
//---------------------------------------------------------------------------
EvtTupleSvc.Output = { "EVTTAGS2 DATAFILE='etc-output2.root' TYP='POOL_ROOTTREE' OPT='RECREATE' " } ;

//////////////////////////////////////////////////////////////////////////////
